<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="content-style-type" content="text/css">
  <meta http-equiv="content-script-type" content="text/javascript">
  <title>Color Scheme</title>

  <link rel="stylesheet" href="../lib/jquery/colpick/css/colpick.css" type="text/css" />
  <link rel="stylesheet" href="../lib/jquery/jquery-ui-1.11.4/jquery-ui.css" type="text/css" />
  <link rel="stylesheet" href="../lib/jquery/simple-color-picker/jquery.simple-color-picker.css" type="text/css" />

  <!--
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js""></script>
  -->
  <script type="text/javascript" src="../lib/jquery/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="../lib/jquery/jquery-ui-1.11.4/jquery-ui.js"></script>
  <script type="text/javascript" src="../lib/jquery/colpick/js/colpick.js"></script>
  <script type="text/javascript" src="../lib/jquery/simple-color-picker/jquery.simple-color-picker.js"></script>

  <style type="text/css">
  html, body {
    height: 100%;
    min-height: 100%;
    margin: 0px;
    padding: 0px;
  }
  body>table {
    border-collapse: collapse;
    width: 100%;
    height: 100%;
  }
  body>table th {
    vertical-align: top;
  }
  body>table td {
    vertical-align: top;
  }
  #menu-wrapper {
    width: 20em;
  }
  #main-wrapper {
    background: #fffcf0;
    height: 95%;
  }
  #foot-wrapper {
    border-top: 5px solid #aaa;
  }
  #divider {
    width: 5px;
    background: #aaa;
  }
  
  .text-item {
    width: 200px;
    min-width: 100px;
    height: 60px;
    min-height: 20px;
    padding: 0.5em;
    font-size: 20px;
    z-index: 2;
  }
  .rect-item {
    width: 40px;
    min-width: 40px;
    height: 40px;
    min-height: 40px;
    background: yellow;
    z-index: 1;
  }
  
  #text-item-select, #rect-item-select {
    width: 60px;
  }
  #font-select optgroup {
    height: 20px;
  }

  .picker {
    margin: 0px;
    padding:0px;
    border:0;
    width:70px;
    height:20px;
    line-height:20px;
  }
  
  .item-pane {
    width: 97%;
    background: #ccc;
    border: solid 1px #000;
    margin: 4px;
    padding: 4px;
  }
  .item-pane th {
    text-align: left;
  }
  .item-pane td {
    padding: 0.2em;
    vertical-align: middle;
  }
  .item-pane span {
    background: white;
    margin: 0.25em;
    display: inline-block;
  }
  .item-pane .spliter {
    border-top: 1px solid #000;
  }
  .item-pane .picker-pane {
    padding: 0.2em;
    background: white;
    box-shadow: 0px 0px 8px rgba(0,0,0,0.4);
  }

  .toolbox {
    width: 40px;
    height: 40px;
    text-align:center;
    vertical-align: middle;
    display: table-cell;
  }
  #garbageCan img {
    vertical-align: middle;
  }
  .dragaccept {
  }
  .dragover {
    background: #c2cbff;
  }
  .editing {
    border: solid 1px #222;
  }
  </style>

  <script>
  // http://jabnz.blog69.fc2.com/blog-entry-664.html
  function addFontsData(fonts){
    for( i=0; i < fonts.length; i++) {
      var g = $('<optgroup>').css('font-family', fonts[i]).appendTo($("#font-select"));
      g.append($('<option>').html(fonts[i]).val(fonts[i]));
    }
  }
  $(function() {
    var flash = 0;
    for(i=0;i<navigator.mimeTypes.length;i++){
        if (navigator.mimeTypes[i].suffixes == "swf"){
            flash = 1;
        }
    }
    if(flash) {
      var el = document.createElement("embed");
      el.src = "getFontsList.swf?function=addFontsData";
      el.width = 1;
      el.height = 1;
      el.wmode = "transparent";
      document.body.appendChild(el);
    } else {
      $("#font-select").attr('disabled', true);
    }
  });
  </script>
  
  <script>
  function blinkBorder(item) {
    var cnt = 0;
    $(item).addClass('editing');
    var timer = setInterval(function () {
        cnt++
        $(item).toggleClass('editing');
        if (cnt == 3) {
            clearInterval(timer);
        }
    }, 400);
  }
  </script>
  <script>
  function rgb2hex(rgb) {
    var ret = eval(rgb.replace(/rgb/,"((").replace(/,/ig,")*256+")).toString(16); 
    return (("000000" + ret).substring( 6 + ret.length - 6));
  }
  function select_text_item(item) {
    var i = $(".text-item").index($(item));
    $("#text-item-select").val(i+1);
    var c = rgb2hex($(item).css('color'));
    $("#col-selector").val(c);
    $("#col-selector").colpickSetColor('#' + c);
    
    var s = $(item).css('font-size');
    $("#size-text").val(s);

    var w = $(item).css('font-weight');
    $("input#weight-text").val(w);
    $("select#weight-text").val(w);
  }
  function select_rect_item(item) {
    var i = $(".rect-item").index($(item));
    $("#rect-item-select").val(i+1);
    var c = rgb2hex($(item).css('background-color'));
    $("#rectcol-selector").val(c);
    $("#rectcol-selector").colpickSetColor('#' + c);
  }

  function delete_ediable(item) {
    $(item).remove();
    if( $(item).hasClass("text-item") ) {
        $("select#text-item-select").children('option:last-child').remove();
        select_text_item($(".text-item").eq(0));
    } else if( $(item).hasClass("text-item") ) {
        $("select#rect-item-select").children('option:last-child').remove();
        select_rect_item($(".rect-item").eq(0));
    }
  }
  function update_ediable() {
    $( ".editable" ).resizable({
        containment: "#main-wrapper"
      , autoHide : true
      , start: function(event, ul) {
        $(this).addClass("editing");
      }
      , stop: function(event, ul) {
        $(this).removeClass("editing");
      }
    }).draggable({
        cursor: "move"
      , containment: "parent"
      , start: function(event, ul) {
        $(this).addClass("editing");
      }
      , stop: function(event, ul) {
        $(this).removeClass("editing");
      }
    }).on('click', function() {
      $(this).draggable({ disabled: false });
    }).on('dblclick', function() {
      $(this).draggable({ disabled: true });
    });
    $( ".text-item").on('mousedown', function () {
      select_text_item(this);
    });
    $( ".rect-item").on('mousedown', function () {
      select_rect_item(this);
    });
    $("#garbageCan").droppable({
      activeClass: "dragaccept",
      hoverClass: "dragover",
      tolerance: "pointer",
      drop: function(event, ui) {
        $('body').css('cursor', 'auto');
        delete_ediable($(ui.draggable));
      }
    });
  }
  function add_text_item() {
    $('#main-wrapper').append("<div class=\"text-item editable\" ><p contenteditable=\"true\">Drag me around<br />Edit by double click</p></div>");
    var index = $(".text-item").size()
    $("#text-item-select").append($('<option>').html(index).val(index));
    update_ediable();
    select_text_item($(".text-item").eq(index-1));
  }
  function add_rect_item() {
    $('#main-wrapper').append("<div class=\"rect-item editable\" style=\"color:yellow;\" ></div>");
    var index = $(".rect-item").size()
    $("#rect-item-select").append($('<option>').html(index).val(index));
    update_ediable();
    select_rect_item($(".rect-item").eq(index-1));
  }
  $(function () {
    add_text_item();
    add_rect_item();
    
    var c = rgb2hex($("#main-wrapper").css('background-color'));
    $("#bg-selector").val(c);
    $("#bg-selector").colpickSetColor('#' + c);
  });
  </script>
  </head>
<body>

<table>
<tr>
<td rowspan="2" id="menu-wrapper">

<table class="item-pane">

<!-- 背景 -->
<tr><th>背景</th><td>
<div class="picker-pane"><span>
#<input type="text" maxlength="6" size="6" value="fefefe" class="picker" id="bg-selector"></input>
<SELECT id="bg-selector-simple" class="simple-picker" name="simple-picker" style="width:20px;" >
</span></div></td></tr>
<tr><td colspan="2" class="spliter"></td></tr>

<!-- 文字 -->
<tr><th>文字</th><td><SELECT id="text-item-select" name="text-item-select" ></SELECT><input type="button" name="追加" value="追加" id="add-text"></input></td></tr>
<tr><td>color </td><td><div class="picker-pane"><span>
#<input type="text" maxlength="6" size="6" value="fefefe" class="picker" id="col-selector"></input>
<SELECT id="col-selector-simple" class="simple-picker" name="simple-picker" style="width:20px;" >
</span></div></th></tr>
<tr><td>size  </td><td><input type="text" value="14px" maxlength="6" size="6" id="size-text"  ></input></td></tr>
<tr><td>weight</td><td>
<!-- <input type="text" value="400"  maxlength="3" size="3" id="weight-text"></input> -->
<SELECT id="weight-text" name="weight-text" >
<option value="100">100</option>
<option value="200">200</option>
<option value="300">300</option>
<option value="400">400</option>
<option value="500">500</option>
<option value="600">600</option>
<option value="700">700</option>
<option value="800">800</option>
</SELECT>
</td></tr>
<tr><td>font  </td><td><SELECT id="font-select" name="font-select" size="4" style="width: 100%"></SELECT></input></td></tr>
<tr><td colspan="2" class="spliter"></td></tr>

<!-- 矩形 -->
<tr><th>矩形</th><td><SELECT id="rect-item-select" name="rect-item-select" ></SELECT><input type="button" name="追加" value="追加" id="add-rect"></input></td></tr>
<tr><td>color </td><td><div class="picker-pane"><span>
#<input type="text" maxlength="6" size="6" value="fefefe" class="picker" id="rectcol-selector"></input>
<SELECT id="rectcol-selector-simple" class="simple-picker" name="simple-picker" style="width:20px;" >
</span></div></td></tr>
<tr><td colspan="2" class="spliter"></td></tr>

</table>

</td>
<td rowspan="2" id="divider" ></td>
<td id="main-wrapper">

</td>

</tr>

<tr>
<td id="foot-wrapper">
<div id="garbageCan" class="toolbox">
  <img src="../images/Tutorial9/recycle32.png" />
</div>
</td>
</tr>
</table>

<script type="text/javascript">
  $('.picker').colpick({
    layout:'full',
    submit:0,
    colorScheme:'light',
    onChange:function(hsb,hex,rgb,el,bySetColor) {
      $(el).parent().parent().css('background','#'+hex);
      // Fill the text box just if the color was set using the picker, and not the colpickSetColor function.
      if(!bySetColor) {
        $(el).val(hex);
      }
      if( $(el).attr('id') == "bg-selector" ) {
        $('#main-wrapper').css('background', '#'+hex);
      }
      if( $(el).attr('id') == "col-selector" ) {
        var index = $("#text-item-select").val();
        $('.text-item').eq(index-1).css('color', '#'+hex);
      }
      if( $(el).attr('id') == "rectcol-selector" ) {
        var index = $("#rect-item-select").val();
        $('.rect-item').eq(index-1).css('background', '#'+hex);
      }
    }
  }).keyup(function(){
    $(this).colpickSetColor(this.value);
  });
  $('.simple-picker').simpleColorPicker({
      colorsPerLine: 16
    , onChangeColor: function(c) {
      var idname = $(this).attr('id').replace(/-simple/g, '');
      $('#' + idname).val(c.replace(/#/, ''));
      $('#' + idname).colpickSetColor(c);
    }
  });
  $('#size-text').change(function(){
    var index = $("#text-item-select").val();
    $('.text-item').eq(index-1).css('font-size', $(this).val());
  });
  $('#weight-text').change(function(){
    var index = $("#text-item-select").val();
    $('.text-item').eq(index-1).css('font-weight', $(this).val());
  });
  $('#font-select').change(function(){
    var index = $("#text-item-select").val();
    $('.text-item').eq(index-1).css('font-family', $(this).val());
  });
  $('.picker-pane').click(function(){
    $(this).find('.picker').trigger("click");
  });
  $('#add-text').click(function(){
    add_text_item();
  });
  $('#add-rect').click(function(){
    add_rect_item();
  });
  $('#rect-item-select').change(function(){
    var index = $("#rect-item-select").val();
    select_rect_item($(".rect-item").eq(index-1));
    blinkBorder($('.rect-item').eq(index-1));
  });
  $('#text-item-select').change(function(){
    var index = $("#text-item-select").val();
    select_text_item($(".text-item").eq(index-1));
    blinkBorder($('.text-item').eq(index-1));
  });
</script>

</body>
</html>
